<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="PREF_OFR_SLOTS_INS_TRG" directorySegmentName="seg_0" id="2B0C10A4-32A6-81BC-25DB-560F27174A28">
<createdBy>Bart≈Çomiej Krawczyk</createdBy>
<createdTime>2022-05-17 14:39:33 UTC</createdTime>
<ownerDesignName>BD2C049</ownerDesignName>
<actions>INSERT</actions>
<body><![CDATA[DECLARE
    v_preferences   NUMBER;
    v_slots         NUMBER;
BEGIN
    -- Count all preferences enrolled
    SELECT 	COUNT(*)
    INTO    v_preferences
    FROM 	preferences p 
    WHERE 	p.course_code = :new.course_code 
        AND p.registration_code = :new.registration_code 
        AND p.result = 'Y';
    
    -- Get the available slots for course in that registration
    SELECT 	available_slots 
    INTO    v_slots
    FROM 	offers o 
    WHERE 	o.course_code = :new.course_code 
        AND o.registration_code = :new.registration_code;
    
    -- Make sure the list of enrolled students is smaller/(equal) than
    -- the number of available slots
	IF v_preferences >= v_slots THEN
		raise_application_error(-20001, 'Not enough slots for the offer!');
	END IF;
END;]]></body>
<triggerTime>BEFORE</triggerTime>
<condition><![CDATA[new.result = 'Y']]></condition>
<table>64116F9A-D9BA-B4DD-769D-EBACFDB2975A</table>
</TriggerOraclev10g>
